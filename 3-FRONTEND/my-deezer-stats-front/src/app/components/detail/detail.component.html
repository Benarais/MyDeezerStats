<div class="detail-container">
    <!-- Header avec bouton retour -->
    <div class="detail-header">
        <button class="back-button" (click)="goBack()">
            <i class="fas fa-arrow-left"></i> Retour
        </button>
    </div>

    <!-- Section Principale -->
    @if (item) {
        <div class="detail-content">
            <!-- Cover + Titre Principal -->
            <div class="detail-hero">
                <img [src]="getCoverUrl()" 
                     [alt]="getMainTitle()" 
                     class="detail-cover">
                
                <div class="detail-meta">
                    <h1 class="detail-title">
                        {{ getMainTitle() }}
                        @if (showArtistSubtitle()) {
                            <span class="detail-artist">
                                {{ item.artist }}
                            </span>
                        }
                    </h1>
                    
                    <div class="detail-stats">
                        <!-- Stats communes -->
                        @if (!isArtist(item) && (isAlbum(item) ? item.playCount !== undefined : false)) {
                            <div class="stat-item">
                                <i class="fas fa-headphones"></i>
                                <span>{{ isAlbum(item) ? item.playCount : 0 | number }} écoute(s)</span>
                            </div>
                        }
                        
                        <!-- Stats spécifiques -->
                        @if (isAlbum(item)) {
                            @if (item.totalDuration !== undefined) {
                                <div class="stat-item">
                                    <i class="fas fa-clock"></i>
                                    <span>{{ item.totalDuration | duration }}</span>
                                </div>
                            }
                            @if (item.releaseDate) {
                                <div class="stat-item">
                                    <i class="fas fa-calendar-alt"></i>
                                    <span>{{ item.releaseDate | date:'yyyy' }}</span>
                                </div>
                            }
                        }

                        @if (isTrack(item)) {
                            @if (item.duration !== undefined) {
                                <div class="stat-item">
                                    <i class="fas fa-clock"></i>
                                    <span>{{ item.duration | duration }}</span>
                                </div>
                            }
                        }
                    </div>
                </div>
            </div>

            <!-- Section spécifique selon le type -->
            @switch (item.type) {
                @case ('album') {
                    <section class="detail-section">
                        <h2><i class="fas fa-compact-disc"></i> Titres</h2>
                        @if (isAlbum(item) && item.tracks) {
                            <div class="track-list">
                                @for (track of item.tracks; track track) {
                                    <div class="track-item">
                                        <div class="track-info">
                                            <h3>{{ track.track }}</h3>
                                            <p>{{ track.artist }}</p>
                                        </div>
                                        <div class="track-duration">{{ track.duration | duration }}</div>
                                    </div>
                                }
                            </div>
                        }
                    </section>
                }
                
                @case ('artist') {
                    <section class="detail-section">
                        <div class="artist-stats">
                            @if (isArtist(item) && item.albumCount !== undefined) {
                                <div class="stat-card">
                                    <h3>Albums</h3>
                                    <p>{{ item.albumCount }}</p>
                                </div>
                            }
                            @if (isArtist(item) && item.trackCount !== undefined) {
                                <div class="stat-card">
                                    <h3>Morceaux</h3>
                                    <p>{{ item.trackCount }}</p>
                                </div>
                            }
                            @if (isArtist(item) && item.popularity !== undefined) {
                                <div class="stat-card">
                                    <h3>Popularité</h3>
                                    <p>{{ item.popularity }}/100</p>
                                </div>
                            }
                        </div>

                        <h2><i class="fas fa-compact-disc"></i> Albums populaires</h2>
                        @if (isArtist(item) && item.topAlbums) {
                            <div class="card-list">
                                @for (album of item.topAlbums; track album) {
                                    <div class="card">
                                        <img [src]="album.coverUrl || 'assets/default-cover.jpg'" 
                                             [alt]="album.title" 
                                             class="card-image">
                                        <div class="card-content">
                                            <h3>{{ album.title }}</h3>
                                            @if (album.releaseDate) {
                                                <p>{{ album.releaseDate | date:'yyyy' }}</p>
                                            }
                                        </div>
                                    </div>
                                }
                            </div>
                        }
                    </section>
                }
                
                @case ('track') {
                    <section class="detail-section">
                        <div class="track-details">
                            @if (isTrack(item) && item.album) {
                                <div class="detail-row">
                                    <span class="detail-label">Album :</span>
                                    <span>{{ item.album }}</span>
                                </div>
                            }
                            @if (isTrack(item) && item.duration !== undefined) {
                                <div class="detail-row">
                                    <span class="detail-label">Durée :</span>
                                    <span>{{ item.duration | duration }}</span>
                                </div>
                            }
                            @if (isTrack(item) && item.firstPlayed) {
                                <div class="detail-row">
                                    <span class="detail-label">Première écoute :</span>
                                    <span>{{ item.firstPlayed | date:'longDate' }}</span>
                                </div>
                            }
                            @if (isTrack(item) && item.lastPlayed) {
                                <div class="detail-row">
                                    <span class="detail-label">Dernière écoute :</span>
                                    <span>{{ item.lastPlayed | date:'longDate' }}</span>
                                </div>
                            }
                        </div>

                        <h2><i class="fas fa-chart-line"></i> Historique des écoutes</h2>
                        @if (isTrack(item) && item.playHistory) {
                            <div class="play-history">
                                @for (play of item.playHistory; track play) {
                                    <div class="play-item">
                                        <span class="play-date">{{ play.date | date:'short' }}</span>
                                        @if (play.count > 1) {
                                            <span class="play-count">
                                                {{ play.count }}x
                                            </span>
                                        }
                                    </div>
                                }
                            </div>
                        }
                    </section>
                }
            }
        </div>
    }
</div>